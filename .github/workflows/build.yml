name: Build & Release

on:
  push:
    tags:
      - "v*"           # triggers on version tags like v1.0, v1.2.3
  workflow_dispatch:   # allows manual trigger from GitHub Actions tab

jobs:
  build-windows:
    name: Build CarGame.exe (Windows / MinGW)
    runs-on: windows-latest

    steps:
      - name: Checkout source
        uses: actions/checkout@v4

      - name: Set up MinGW
        uses: msys2/setup-msys2@v2
        with:
          msystem: MINGW64
          update: true
          install: mingw-w64-x86_64-gcc

      - name: Compile
        shell: msys2 {0}
        run: |
          g++ -std=c++17 -O2 -o CarGame.exe CarGame.cpp
          echo "Build successful"

      - name: Upload artifact (every push)
        uses: actions/upload-artifact@v4
        with:
          name: CarGame-Windows
          path: CarGame.exe
          retention-days: 30

      # â”€â”€ Create a GitHub Release only when triggered by a tag â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Create GitHub Release
        if: startsWith(github.ref, 'refs/tags/')
        uses: softprops/action-gh-release@v2
        with:
          name: "Car Game ${{ github.ref_name }}"
          body: |
            ## ðŸš— Car Game ${{ github.ref_name }}

            ### How to Play
            1. Download `CarGame.exe` below
            2. Double-click to run â€” no installation needed!

            ### Controls
            | Key | Action |
            |-----|--------|
            | A   | Move left |
            | D   | Move right |
            | ESC | Quit to menu |

            > **Windows only** â€” requires no dependencies.
          files: CarGame.exe
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
